<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI ìŠ¤ë§ˆíŠ¸ ì—¬í–‰ í”Œë˜ë„ˆ</title>
    <link rel="stylesheet" href="/static/css/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Poppins:wght@600&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>âœˆï¸ AI ìŠ¤ë§ˆíŠ¸ ì—¬í–‰ í”Œë˜ë„ˆ</h1>
        <p>
          ê°€ê³  ì‹¶ì€ ê³³ê³¼ ì—¬í–‰ ìŠ¤íƒ€ì¼ì„ ì•Œë ¤ì£¼ì‹œë©´, AIê°€ ë§ì¶¤ ì—¬í–‰ ê²½ë¡œë¥¼ ì¶”ì²œí•´
          ë“œë ¤ìš”.
        </p>
      </header>

      <main>
        <form id="travel-form">
          <div class="form-grid">
            <div class="form-group full-width">
              <label for="destination">ì–´ë””ë¡œ ë– ë‚˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?</label>
              <input
                type="text"
                id="destination"
                name="destination"
                placeholder="ì˜ˆ: ìŠ¤ìœ„ìŠ¤ ì¸í„°ë¼ì¼„"
                required
              />
            </div>
            <div class="form-group">
              <label for="duration">ì—¬í–‰ ê¸°ê°„</label>
              <input
                type="text"
                id="duration"
                name="duration"
                placeholder="ì˜ˆ: 3ë°• 4ì¼"
                required
              />
            </div>
            <div class="form-group">
              <label for="headcount">ì¸ì›ìˆ˜</label>
              <select id="headcount" name="headcount">
                <option value="í˜¼ì">í˜¼ì</option>
                <option value="2ëª…">2ëª…</option>
                <option value="3~4ëª…">3~4ëª…</option>
                <option value="5ëª… ì´ìƒ">5ëª… ì´ìƒ</option>
              </select>
            </div>
            <div class="form-group">
              <label for="gender">ì„±ë³„</label>
              <select id="gender" name="gender">
                <option value="ìƒê´€ì—†ìŒ">ìƒê´€ì—†ìŒ</option>
                <option value="ë‚¨ì„±">ë‚¨ì„±</option>
                <option value="ì—¬ì„±">ì—¬ì„±</option>
                <option value="í˜¼ì„±">í˜¼ì„±</option>
              </select>
            </div>
            <div class="form-group">
              <label for="age">ë‚˜ì´ëŒ€</label>
              <select id="age" name="age">
                <option value="20ëŒ€">20ëŒ€</option>
                <option value="30ëŒ€">30ëŒ€</option>
                <option value="40ëŒ€">40ëŒ€</option>
                <option value="50ëŒ€ ì´ìƒ">50ëŒ€ ì´ìƒ</option>
              </select>
            </div>
            <div class="form-group">
              <label for="style">ì—¬í–‰ ìŠ¤íƒ€ì¼</label>
              <select id="style" name="style">
                <option value="íœ´ì–‘/íë§">íœ´ì–‘/íë§</option>
                <option value="ì»¤í”Œ ì—¬í–‰">ì»¤í”Œ ì—¬í–‰</option>
                <option value="ê°€ì¡± ì—¬í–‰">ê°€ì¡± ì—¬í–‰</option>
                <option value="ì•¡í‹°ë¹„í‹°/ëª¨í—˜">ì•¡í‹°ë¹„í‹°/ëª¨í—˜</option>
                <option value="ë¬¸í™”/ì—­ì‚¬ íƒë°©">ë¬¸í™”/ì—­ì‚¬ íƒë°©</option>
              </select>
            </div>
            <div class="form-group">
              <label for="budget">ì˜ˆì‚° (1ì¸ ê¸°ì¤€)</label>
              <select id="budget" name="budget">
                <option value="100ë§Œì› ì´í•˜">100ë§Œì› ì´í•˜</option>
                <option value="200ë§Œì› ì´í•˜">200ë§Œì› ì´í•˜</option>
                <option value="300ë§Œì› ì´í•˜">300ë§Œì› ì´í•˜</option>
                <option value="ë„‰ë„‰í•˜ê²Œ">ë„‰ë„‰í•˜ê²Œ</option>
              </select>
            </div>
          </div>
          <button type="submit" id="submit-btn">
            ë‚˜ë§Œì˜ ì—¬í–‰ ê²½ë¡œ ì¶”ì²œë°›ê¸°
          </button>
        </form>

        <div id="loading-indicator" class="hidden">
          <div class="spinner"></div>
          <p>ìµœê³ ì˜ ì—¬í–‰ ê²½ë¡œë¥¼ ë§Œë“¤ê³  ìˆì–´ìš”... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!</p>
        </div>

        <div id="result-container" class="hidden">
          <h2>ğŸ“ AI ì¶”ì²œ ì—¬í–‰ ê²½ë¡œ</h2>
          <div id="result-content"></div>
        </div>
      </main>
    </div>

    <script>
      const form = document.getElementById("travel-form");
      const submitBtn = document.getElementById("submit-btn");
      const loadingIndicator = document.getElementById("loading-indicator");
      const resultContainer = document.getElementById("result-container");
      const resultContent = document.getElementById("result-content");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        loadingIndicator.classList.remove("hidden");
        resultContainer.classList.add("hidden");
        submitBtn.disabled = true;

        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        try {
          const response = await fetch("/api/recommend", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          if (!response.ok) {
            throw new Error(
              "ì„œë²„ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
            );
          }

          const result = await response.json();
          // Geminiê°€ ìƒì„±í•œ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì˜ í…ìŠ¤íŠ¸ë¥¼ HTMLë¡œ ë³´ê¸° ì¢‹ê²Œ ë³€í™˜í•©ë‹ˆë‹¤.
          const formattedResult = result.recommendation
            .replace(/### (.*)/g, "<h3>$1</h3>")
            .replace(/\*\*([^*]+)\*\*/g, "<strong>$1</strong>")
            .replace(/\n/g, "<br>");

          resultContent.innerHTML = formattedResult;
          resultContainer.classList.remove("hidden");
        } catch (error) {
          resultContent.innerHTML = `<p style="color: red;">${error.message}</p>`;
          resultContainer.classList.remove("hidden");
        } finally {
          loadingIndicator.classList.add("hidden");
          submitBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>
